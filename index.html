<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Unit 5 Weather Adventure</title>
    
    <!-- ‰ΩøÁî®ÂõΩÂÜÖÊûÅÈÄü CDN (Staticfile) Ëß£ÂÜ≥Âä†ËΩΩÂ§±Ë¥•ÈóÆÈ¢ò -->
    <script src="https://cdn.staticfile.org/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdn.staticfile.org/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.staticfile.org/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.staticfile.org/tailwindcss/3.3.5/tailwind.min.js"></script>
    
    <style>
        body { font-family: 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif; background-color: #f0f9ff; touch-action: manipulation; }
        .spinner { width: 40px; height: 40px; border: 4px solid #e2e8f0; border-top-color: #3b82f6; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        /* ÈîôËØØÊèêÁ§∫Ê°ÜÊ†∑Âºè */
        #error-box { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border-radius: 10px; box-shadow: 0 10px 25px rgba(0,0,0,0.2); text-align: center; z-index: 100; max-width: 90%; }
    </style>
</head>
<body>

    <!-- Âä†ËΩΩ‰∏≠ÁïåÈù¢ -->
    <div id="loading" style="position:fixed; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center; background:white; z-index:50;">
        <div class="spinner"></div>
        <p style="margin-top:15px; color:#64748b;">Ê≠£Âú®Âä†ËΩΩËÆ≠ÁªÉËê•ËµÑÊ∫ê...</p>
    </div>

    <!-- ÈîôËØØÊèêÁ§∫ÁïåÈù¢ -->
    <div id="error-box">
        <h3 style="color:#ef4444; font-weight:bold; font-size:18px; margin-bottom:10px;">‚ö†Ô∏è ËøêË°åÂá∫Èîô‰∫Ü</h3>
        <p id="error-msg" style="color:#334155; font-size:14px; margin-bottom:15px;"></p>
        <button onclick="location.reload()" style="background:#3b82f6; color:white; padding:8px 20px; border:none; border-radius:5px;">Âà∑Êñ∞ÈáçËØï</button>
    </div>

    <div id="root" style="height: 100vh; width: 100vw; display: flex; justify-content: center; align-items: center;"></div>

    <script type="text/babel">
    try {
        const { useState, useEffect, useMemo } = React;

        // --- ÂõæÊ†áÁªÑ‰ª∂ (SVG) ---
        const Icons = {
            Sun: <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>,
            Cloud: <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242" /></svg>,
            CloudRain: <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242"/><path d="M16 14v6"/><path d="M8 14v6"/><path d="M12 16v6"/></svg>,
            Wind: <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17.7 7.7a2.5 2.5 0 1 1 1.8 4.3H2"/><path d="M9.6 4.6A2 2 0 1 1 11 8H2"/><path d="M12.6 19.4A2 2 0 1 0 14 16H2"/></svg>,
            Snowflake: <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="2" y1="12" x2="22" y2="12"/><line x1="12" y1="2" x2="12" y2="22"/><path d="m20 16-4-4 4-4"/><path d="m4 8 4 4-4 4"/><path d="m16 4-4 4-4-4"/><path d="m8 20 4-4 4 4"/></svg>,
            Phone: <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>,
            Mic: <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></svg>,
            Star: <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>,
            Lock: <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>,
            Play: <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="5 3 19 12 5 21 5 3"/></svg>,
            Trophy: <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>,
            Heart: <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>,
            ArrowRight: <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>,
            Check: <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"/></svg>,
            X: <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
            Volume2: <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/></svg>,
            Thermometer: <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z"/></svg>,
            Calendar: <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>,
            MapPin: <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>,
            Film: <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18"/><line x1="7" y1="2" x2="7" y2="22"/><line x1="17" y1="2" x2="17" y2="22"/><line x1="2" y1="12" x2="22" y2="12"/><line x1="2" y1="7" x2="7" y2="7"/><line x1="2" y1="17" x2="7" y2="17"/><line x1="17" y1="17" x2="22" y2="17"/><line x1="17" y1="7" x2="22" y2="7"/></svg>,
            Plane: <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 12h5l3 5v5l5-5h5a2 2 0 0 0 0-4h-5l-5-5v5l-3 5H2Z"/></svg>,
            Frown: <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="M16 16s-1.5-2-4-2-4 2-4 2"/><line x1="9" y1="9" x2="9.01" y2="9"/><line x1="15" y1="9" x2="15.01" y2="9"/></svg>,
            Umbrella: <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 12a10.06 10.06 0 0 0-20 0Z"/><path d="M12 12v8a2 2 0 0 0 4 0"/></svg>,
            Droplets: <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.8-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z"/><path d="M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97"/></svg>,
            BookOpen: <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>,
            MessageCircle: <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/></svg>,
            User: <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>,
            Feather: <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20.24 12.24a6 6 0 0 0-8.49-8.49L5 10.5V19h8.5z"/><line x1="16" y1="8" x2="2" y2="22"/><line x1="17.5" y1="15" x2="9" y2="15"/></svg>,
            Music: <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></svg>,
            Book: <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>,
            Shield: <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>,
            Zap: <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
        };

        const Icon = ({ name, className, size = 24 }) => {
            const SvgIcon = Icons[name];
            if (!SvgIcon) return null;
            return React.cloneElement(SvgIcon, { className, width: size, height: size });
        };

        // --- Ê†∏ÂøÉÊï∞ÊçÆ ---
        const level1Data = [
            { type: 'voiced', symbol: '/√∞/', target: 'these', distractors: ['three', 'think', 'thumb'], question: 'Which word has the voiced /√∞/ sound?' },
            { type: 'unvoiced', symbol: '/Œ∏/', target: 'think', distractors: ['this', 'father', 'they'], question: 'Which word has the unvoiced /Œ∏/ sound?' },
            { type: 'voiced', symbol: '/√∞/', target: 'father', distractors: ['both', 'thing', 'thank'], question: 'Find the buzzing /√∞/ sound:' },
            { type: 'unvoiced', symbol: '/Œ∏/', target: 'three', distractors: ['there', 'their', 'weather'], question: 'Find the soft /Œ∏/ sound:' },
            { type: 'voiced', symbol: '/√∞/', target: 'they', distractors: ['thank', 'thumb', 'thin'], question: 'Select the word starting with /√∞/:' },
            { type: 'voiced', symbol: '/√∞/', target: 'there', distractors: ['three', 'birthday', 'math'], question: 'Which word sounds like "father"?' },
            { type: 'unvoiced', symbol: '/Œ∏/', target: 'both', distractors: ['brother', 'that', 'smooth'], question: 'Which word ends with soft /Œ∏/?' },
            { type: 'unvoiced', symbol: '/Œ∏/', target: 'thing', distractors: ['this', 'those', 'mother'], question: 'Select the unvoiced /Œ∏/ word:' },
            { type: 'voiced', symbol: '/√∞/', target: 'brother', distractors: ['birthday', 'month', 'think'], question: 'Find the middle /√∞/ sound:' },
            { type: 'unvoiced', symbol: '/Œ∏/', target: 'thank', distractors: ['that', 'than', 'them'], question: 'Which is an unvoiced /Œ∏/ word?' },
            { type: 'voiced', symbol: '/√∞/', target: 'mother', distractors: ['mouth', 'math', 'three'], question: 'Which word has the voiced /√∞/?' },
            { type: 'unvoiced', symbol: '/Œ∏/', target: 'math', distractors: ['mother', 'smooth', 'weather'], question: 'Find the word ending in /Œ∏/:' },
            { type: 'voiced', symbol: '/√∞/', target: 'that', distractors: ['thin', 'thick', 'thumb'], question: 'Select the voiced /√∞/ word:' },
            { type: 'unvoiced', symbol: '/Œ∏/', target: 'thin', distractors: ['this', 'then', 'the'], question: 'Opposite of thick. Starts with /Œ∏/:' },
            { type: 'voiced', symbol: '/√∞/', target: 'those', distractors: ['thumb', 'thirteen', 'thought'], question: 'Plural of "that". Starts with /√∞/:' },
            { type: 'unvoiced', symbol: '/Œ∏/', target: 'birthday', distractors: ['brother', 'father', 'feather'], question: 'Find the soft /Œ∏/ in the middle:' },
            { type: 'voiced', symbol: '/√∞/', target: 'weather', distractors: ['thing', 'path', 'south'], question: 'Which word has the buzzing /√∞/?' },
            { type: 'unvoiced', symbol: '/Œ∏/', target: 'mouth', distractors: ['mother', 'smooth', 'breathe'], question: 'Body part with soft /Œ∏/:' },
            { type: 'voiced', symbol: '/√∞/', target: 'feather', distractors: ['teeth', 'health', 'north'], question: 'Light as a... (Voiced /√∞/):' },
            { type: 'unvoiced', symbol: '/Œ∏/', target: 'thirty', distractors: ['there', 'thy', 'worthy'], question: 'Number word with unvoiced /Œ∏/:' },
        ];

        const level2Data = [
            { word: 'sunny', cn: 'Èò≥ÂÖâÂÖÖË∂≥ÁöÑ', icon: 'Sun', type: 'adj' },
            { word: 'snowy', cn: 'Â§öÈõ™ÁöÑ', icon: 'Snowflake', type: 'adj' },
            { word: 'windy', cn: 'Â§öÈ£éÁöÑ', icon: 'Wind', type: 'adj' },
            { word: 'rainy', cn: 'Èò¥Èõ®ÁöÑ', icon: 'CloudRain', type: 'adj' },
            { word: 'cloudy', cn: 'Â§ö‰∫ëÁöÑ', icon: 'Cloud', type: 'adj' },
            { word: 'hot', cn: 'ÁÉ≠ÁöÑ', icon: 'Sun', type: 'adj' },
            { word: 'cold', cn: 'ÂÜ∑ÁöÑ', icon: 'Thermometer', type: 'adj' },
            { word: 'cool', cn: 'ÂáâÁàΩÁöÑ', icon: 'Wind', type: 'adj' },
            { word: 'warm', cn: 'Ê∏©ÊöñÁöÑ', icon: 'Sun', type: 'adj' },
            { word: 'bad', cn: 'ÂùèÁöÑ; ‰ª§‰∫∫‰∏çÂø´ÁöÑ', icon: 'Frown', type: 'adj' },
            { word: 'tomorrow', cn: 'Âú®ÊòéÂ§©', icon: 'Calendar', type: 'time' },
            { word: 'Sydney', cn: 'ÊÇâÂ∞º', icon: 'MapPin', type: 'place' },
            { word: 'closed', cn: 'ÂÖ≥Èó≠ÁöÑ', icon: 'Lock', type: 'status' },
            { word: 'film', cn: 'ÁîµÂΩ±', icon: 'Film', type: 'noun' },
            { word: 'fly', cn: 'È£û; ÊìçÁ∫µ', icon: 'Plane', type: 'verb' },
            { word: 'swim', cn: 'Ê∏∏Ê≥≥', icon: 'Droplets', type: 'verb' },
            { word: 'weather', cn: 'Â§©Ê∞î', icon: 'Cloud', type: 'noun' },
            { word: 'kite', cn: 'È£éÁ≠ù', icon: 'Wind', type: 'noun' },
            { word: 'snowman', cn: 'Èõ™‰∫∫', icon: 'User', type: 'noun' },
            { word: 'speak', cn: 'ËØ¥ËØù; ÂèëË®Ä', icon: 'MessageCircle', type: 'verb' },
        ];

        const level3Data = [
            { weather: 'It‚Äôs cold and rainy.', scenario: 'We can‚Äôt play football.', correct: 'make a card', wrong: 'fly a kite', question: 'What can we do inside?' },
            { weather: 'It‚Äôs snowy.', scenario: 'Let‚Äôs go outside!', correct: 'make a snowman', wrong: 'swim', question: 'What is a good winter activity?' },
            { weather: 'It‚Äôs warm and sunny.', scenario: 'The park is open.', correct: 'fly a kite', wrong: 'see a film', question: 'Best activity for a windy sunny day?' },
            { weather: 'It‚Äôs bad weather.', scenario: 'We can‚Äôt go out.', correct: 'see a film', wrong: 'water the flowers', question: 'What to do at home?' },
            { weather: 'It‚Äôs sunny and hot.', scenario: 'The flowers are dry.', correct: 'water the flowers', wrong: 'make a snowman', question: 'What should we do in the garden?' },
            { weather: 'It‚Äôs a rainy afternoon.', scenario: 'I want to read books.', correct: 'go to the library', wrong: 'go to the park', question: 'Where should we go?' },
            { weather: 'It‚Äôs cool and sunny.', scenario: 'Let\'s do sports!', correct: 'play basketball', wrong: 'see a film', question: 'What sport can we play outside?' },
            { weather: 'It‚Äôs 30 degrees (Hot).', scenario: 'I want to be cool.', correct: 'swim', wrong: 'make a snowman', question: 'What is a good summer activity?' },
            { weather: 'It‚Äôs rainy outside.', scenario: 'I don\'t want to get wet.', correct: 'take an umbrella', wrong: 'wear sunglasses', question: 'What should you take?' },
            { weather: 'It‚Äôs windy.', scenario: 'My hat is flying away.', correct: 'hold your hat', wrong: 'open an umbrella', question: 'What should you do?' },
            { weather: 'It‚Äôs very cold.', scenario: 'I\'m going out.', correct: 'wear a coat', wrong: 'wear a t-shirt', question: 'Dress for the weather:' },
            { weather: 'It‚Äôs sunny.', scenario: 'The sun is bright.', correct: 'wear sunglasses', wrong: 'wear rainboots', question: 'Protect your eyes:' },
            { weather: 'It‚Äôs snowing.', scenario: 'The ground is white.', correct: 'play in the snow', wrong: 'swim in the sea', question: 'Fun activity?' },
            { weather: 'Can we go to the park?', scenario: 'It\'s raining hard.', correct: 'No, we can\'t.', wrong: 'Yes, we can.', question: 'Logical answer:' },
            { weather: 'Can we make a snowman?', scenario: 'It\'s hot and sunny.', correct: 'No, we can\'t.', wrong: 'Yes, we can.', question: 'Logical answer:' },
            { weather: 'It\'s cloudy.', scenario: 'It might rain soon.', correct: 'take a raincoat', wrong: 'wear shorts', question: 'Be prepared:' },
            { weather: 'Sydney is hot.', scenario: 'I am in Sydney.', correct: 'I can swim.', wrong: 'I can make a snowman.', question: 'What can you do?' },
            { weather: 'London is rainy.', scenario: 'I am in London.', correct: 'I can read at home.', wrong: 'I can play football outside.', question: 'Activity choice:' },
            { weather: 'The library is closed.', scenario: 'I have a new book.', correct: 'read at home', wrong: 'go to the library', question: 'Logic check:' },
            { weather: 'The water is warm.', scenario: 'We are at the pool.', correct: 'swim', wrong: 'fly a kite', question: 'What activity matches?' },
        ];

        const level4Data = [
            { q: 'Hello! Mark ______.', options: ['speaking', 'talking', 'saying', 'calling'], answer: 'speaking', hint: 'Telephone rule: Name + speaking' },
            { q: 'Hi Mark! ______ is John.', options: ['This', 'I', 'He', 'Here'], answer: 'This', hint: 'Telephone rule: This is...' },
            { q: 'What‚Äôs the weather ______ in Sydney?', options: ['like', 'love', 'look', 'likes'], answer: 'like', hint: 'Pattern: What\'s the weather like...?' },
            { q: 'We ______ play football because it is raining.', options: ['can\'t', 'can', 'do', 'are'], answer: 'can\'t', hint: 'Reasoning: Rain means no outdoor sports.' },
            { q: 'Can we ______ a kite?', options: ['fly', 'flying', 'flies', 'flew'], answer: 'fly', hint: 'Grammar: Can + Verb (base form)' },
            { q: 'It\'s cold ______ snowy.', options: ['and', 'but', 'or', 'so'], answer: 'and', hint: 'Connecting two similar descriptions.' },
            { q: 'Can I have ______ soup?', options: ['some', 'any', 'a', 'an'], answer: 'some', hint: 'Polite request uses "some".' },
            { q: 'Is that the weather report?', options: ['Yes, it is.', 'Yes, I am.', 'No, he isn\'t.', 'Yes, they are.'], answer: 'Yes, it is.', hint: 'Subject is "it".' },
            { q: 'It\'s ______ in Beijing.', options: ['sunny', 'sun', 'suns', 'sunned'], answer: 'sunny', hint: 'Use adjectives for weather.' },
            { q: 'Can you ______ a snowman?', options: ['make', 'making', 'makes', 'made'], answer: 'make', hint: 'Can + Base Verb' },
            { q: 'The library is ______.', options: ['closed', 'close', 'closing', 'closes'], answer: 'closed', hint: 'Adjective meaning not open.' },
            { q: 'What do you do ______ rainy days?', options: ['on', 'in', 'at', 'of'], answer: 'on', hint: 'Preposition for days.' },
            { q: 'It\'s hot inside. Can I ______ the window?', options: ['open', 'opens', 'opening', 'opened'], answer: 'open', hint: 'Can + Base Verb' },
            { q: '______ is the weather like?', options: ['What', 'How', 'Where', 'When'], answer: 'What', hint: 'What... like?' },
            { q: '______ is the weather?', options: ['How', 'What', 'Who', 'Which'], answer: 'How', hint: 'How is the weather? (No like)' },
            { q: 'Be careful! It\'s ______.', options: ['slippery', 'slip', 'slipped', 'slips'], answer: 'slippery', hint: 'Need an adjective.' },
            { q: 'Look at ______ clouds!', options: ['those', 'that', 'this', 'they'], answer: 'those', hint: 'Plural clouds -> those' },
            { q: 'Let\'s ______ home.', options: ['go', 'goes', 'going', 'gone'], answer: 'go', hint: 'Let\'s + Base Verb' },
            { q: 'Is it cold? No, it ______.', options: ['isn\'t', 'is', 'aren\'t', 'not'], answer: 'isn\'t', hint: 'Negative short answer.' },
            { q: 'Do you like ______ days?', options: ['rainy', 'rain', 'rains', 'raining'], answer: 'rainy', hint: 'Adjective describing days.' },
        ];

        // --- ËæÖÂä©ÂáΩÊï∞ ---
        const shuffleArray = (array) => {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        };

        const speak = (text) => {
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'en-US';
            utterance.rate = 0.9;
            window.speechSynthesis.speak(utterance);
        };

        // --- Â≠êÁªÑ‰ª∂ ---

        const ReviewScreen = ({ onFinish }) => {
            const [activeTab, setActiveTab] = useState('map');
            const phonicsReview = useMemo(() => {
                const voiced = [...new Set(level1Data.filter(d => d.type === 'voiced').map(d => d.target))];
                const unvoiced = [...new Set(level1Data.filter(d => d.type === 'unvoiced').map(d => d.target))];
                return { voiced, unvoiced };
            }, []);

            return (
                <div className="h-full flex flex-col bg-slate-50 overflow-hidden">
                    <div className="bg-indigo-600 text-white p-4 shadow-md flex justify-between items-center z-10">
                        <h2 className="font-bold text-xl flex items-center gap-2"><Icon name="BookOpen"/> ËÆ≠ÁªÉËê• (Training Camp)</h2>
                        <button onClick={onFinish} className="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-full font-bold text-sm flex items-center gap-1 transition-colors shadow-sm">
                            ÂáÜÂ§áÂÜíÈô© (Ready) <Icon name="ArrowRight" size={16}/>
                        </button>
                    </div>
                    <div className="flex bg-white shadow-sm overflow-x-auto">
                        {[{id:'map',l:'ÂçïÂÖÉËÑâÁªú',i:'MapPin'},{id:'phonics',l:'ËØ≠Èü≥',i:'Mic'},{id:'words',l:'ËØçÊ±á',i:'Shield'},{id:'grammar',l:'ËØ≠Ê≥ï',i:'Zap'}].map(tab => (
                            <button key={tab.id} onClick={() => setActiveTab(tab.id)} className={`flex-1 min-w-[100px] p-3 text-sm font-bold flex flex-col items-center border-b-4 transition-colors ${activeTab === tab.id ? 'border-indigo-600 text-indigo-700 bg-indigo-50' : 'border-transparent text-gray-500'}`}>
                                <Icon name={tab.i} size={18} /> {tab.l}
                            </button>
                        ))}
                    </div>
                    <div className="flex-1 overflow-y-auto p-6">
                        {activeTab === 'map' && (
                            <div className="space-y-6 animate-fadeIn">
                                <div className="bg-blue-50 p-6 rounded-2xl border border-blue-100 text-center">
                                    <h3 className="text-xl font-bold text-blue-800">Unit 5: The weather and us</h3>
                                    <p className="text-sm text-gray-500 mt-1">Â§©Ê∞îÂ¶Ç‰ΩïÂΩ±Âìç‰∫∫‰ª¨ÁöÑÁîüÊ¥ªÔºü</p>
                                </div>
                                <div className="grid md:grid-cols-2 gap-4">
                                    <div className="bg-white p-5 rounded-xl border-l-4 border-orange-400">
                                        <h4 className="font-bold text-orange-600 mb-2 flex items-center gap-2"><Icon name="Sun"/> Part A: Â§©Ê∞î</h4>
                                        <ul className="text-sm space-y-2 text-gray-700"><li>‚Ä¢ Different weather in different places.</li><li>‚Ä¢ Use adjectives: sunny, rainy...</li></ul>
                                    </div>
                                    <div className="bg-white p-5 rounded-xl border-l-4 border-green-400">
                                        <h4 className="font-bold text-green-600 mb-2 flex items-center gap-2"><Icon name="User"/> Part B: Ê¥ªÂä®</h4>
                                        <ul className="text-sm space-y-2 text-gray-700"><li>‚Ä¢ Weather decides activities.</li><li>‚Ä¢ Good weather ‚Üí Outdoor</li></ul>
                                    </div>
                                </div>
                            </div>
                        )}
                        {activeTab === 'phonics' && (
                            <div className="grid md:grid-cols-2 gap-6 animate-fadeIn">
                                <div className="bg-white p-4 rounded-xl border-t-4 border-red-400">
                                    <h3 className="text-red-600 font-bold mb-2">/√∞/ ÊµäËæÖÈü≥ (Â£∞Â∏¶ÊåØÂä®)</h3>
                                    <div className="flex flex-wrap gap-2">{phonicsReview.voiced.map(w => <button key={w} onClick={() => speak(w)} className="px-3 py-1 bg-red-50 text-red-700 rounded-full text-sm">{w}</button>)}</div>
                                </div>
                                <div className="bg-white p-4 rounded-xl border-t-4 border-blue-400">
                                    <h3 className="text-blue-600 font-bold mb-2">/Œ∏/ Ê∏ÖËæÖÈü≥ (Âè™ÊúâÊ∞îÊµÅ)</h3>
                                    <div className="flex flex-wrap gap-2">{phonicsReview.unvoiced.map(w => <button key={w} onClick={() => speak(w)} className="px-3 py-1 bg-blue-50 text-blue-700 rounded-full text-sm">{w}</button>)}</div>
                                </div>
                            </div>
                        )}
                        {activeTab === 'words' && (
                            <div className="grid grid-cols-2 md:grid-cols-3 gap-3 animate-fadeIn">
                                {level2Data.map((item, idx) => (
                                    <div key={idx} onClick={() => speak(item.word)} className="bg-white p-3 rounded-xl shadow-sm border text-center cursor-pointer">
                                        <div className="text-indigo-500 mb-1 flex justify-center"><Icon name={item.icon}/></div>
                                        <div className="font-bold">{item.word}</div>
                                        <div className="text-xs text-gray-500">{item.cn}</div>
                                    </div>
                                ))}
                            </div>
                        )}
                        {activeTab === 'grammar' && (
                            <div className="space-y-4 animate-fadeIn">
                                <div className="bg-white p-4 border-l-4 border-indigo-500 rounded shadow-sm">
                                    <h4 className="font-bold text-indigo-700">ËØ¢ÈóÆÂ§©Ê∞î</h4>
                                    <p className="text-sm bg-slate-100 p-2 mt-1 rounded">Q: What's the weather like?</p>
                                </div>
                                <div className="bg-white p-4 border-l-4 border-pink-500 rounded shadow-sm">
                                    <h4 className="font-bold text-pink-700">ÁîµËØùÁî®ËØ≠</h4>
                                    <p className="text-sm bg-slate-100 p-2 mt-1 rounded">‚úÖ This is Mark. / Mark speaking.</p>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const PhonicsGame = ({ qIndex, setQIndex, setFeedback, feedback, setCoins, setLives, handleLevelComplete }) => {
            const currentQ = level1Data[qIndex];
            const options = useMemo(() => shuffleArray([currentQ.target, ...currentQ.distractors]), [currentQ]);
            const handleAnswer = (word) => {
                if(feedback) return;
                if(word === currentQ.target) { setFeedback('correct'); speak("Correct!"); setCoins(c=>c+10); setTimeout(() => { setFeedback(null); qIndex < level1Data.length -1 ? setQIndex(p=>p+1) : handleLevelComplete(); }, 1000); }
                else { setFeedback('wrong'); setLives(l=>l-1); setTimeout(() => setFeedback(null), 800); }
            };
            return (
                <div className="w-full max-w-md animate-fadeIn">
                    <div className="text-center mb-6"><span className="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm font-bold">{currentQ.symbol} {currentQ.type}</span><h3 className="text-xl font-bold mt-2">{currentQ.question}</h3></div>
                    <div className="grid gap-3">{options.map((w,i) => <button key={i} onClick={() => {speak(w); handleAnswer(w);}} className={`p-4 rounded-xl border-2 font-bold flex justify-between ${feedback === 'correct' && w === currentQ.target ? 'bg-green-100 border-green-500' : 'bg-white border-gray-200'}`}>{w} <Icon name="Volume2" size={16}/></button>)}</div>
                </div>
            );
        };

        const VocabGame = ({ qIndex, setQIndex, setFeedback, feedback, setCoins, setLives, handleLevelComplete }) => {
            const currentWord = level2Data[qIndex];
            const allOptions = useMemo(() => shuffleArray([...shuffleArray(level2Data.filter(d => d.word !== currentWord.word)).slice(0, 3), currentWord]), [currentWord]);
            const handleAnswer = (opt) => {
                if(feedback) return;
                if(opt.word === currentWord.word) { setFeedback('correct'); speak(currentWord.word); setCoins(c=>c+10); setTimeout(() => { setFeedback(null); qIndex < level2Data.length -1 ? setQIndex(p=>p+1) : handleLevelComplete(); }, 1000); }
                else { setFeedback('wrong'); setLives(l=>l-1); setTimeout(() => setFeedback(null), 800); }
            };
            return (
                <div className="w-full max-w-md text-center animate-fadeIn">
                    <div className="bg-white p-8 rounded-2xl shadow mb-6"><div className="scale-150 mb-2 flex justify-center text-blue-500"><Icon name={currentWord.icon} size={40}/></div><h2 className="text-2xl font-bold">{currentWord.cn}</h2></div>
                    <div className="grid grid-cols-2 gap-3">{allOptions.map((opt,i) => <button key={i} onClick={() => handleAnswer(opt)} className={`p-4 rounded-xl font-bold ${feedback === 'correct' && opt.word === currentWord.word ? 'bg-green-500 text-white' : 'bg-white shadow'}`}>{opt.word}</button>)}</div>
                </div>
            );
        };

        const PhraseGame = ({ qIndex, setQIndex, setFeedback, feedback, setCoins, setLives, handleLevelComplete }) => {
            const data = level3Data[qIndex];
            const options = useMemo(() => shuffleArray([{t:data.correct, ok:true}, {t:data.wrong, ok:false}]), [data]);
            const handleAnswer = (isCorrect) => {
                if(feedback) return;
                if(isCorrect) { setFeedback('correct'); setCoins(c=>c+15); setTimeout(() => { setFeedback(null); qIndex < level3Data.length -1 ? setQIndex(p=>p+1) : handleLevelComplete(); }, 1000); }
                else { setFeedback('wrong'); setLives(l=>l-1); setTimeout(() => setFeedback(null), 800); }
            };
            return (
                <div className="w-full max-w-md animate-fadeIn">
                    <div className="bg-indigo-600 text-white p-6 rounded-2xl mb-6 relative overflow-hidden"><div className="relative z-10"><p className="font-bold text-xl">{data.weather}</p><p>"{data.scenario}"</p></div></div>
                    <p className="text-center font-bold mb-4">{data.question}</p>
                    <div className="space-y-3">{options.map((opt,i) => <button key={i} onClick={() => handleAnswer(opt.ok)} className={`w-full p-4 bg-white rounded-xl border-l-8 flex justify-between ${feedback === 'correct' && opt.ok ? 'border-green-500' : 'border-blue-200'}`}>{opt.t}</button>)}</div>
                </div>
            );
        };

        const GrammarBoss = ({ qIndex, setQIndex, setFeedback, feedback, setCoins, setLives, handleLevelComplete }) => {
            const data = level4Data[qIndex];
            const options = useMemo(() => shuffleArray(data.options), [data]);
            const handleAnswer = (val) => {
                if(feedback) return;
                if(val === data.answer) { setFeedback('correct'); setCoins(c=>c+20); setTimeout(() => { setFeedback(null); qIndex < level4Data.length -1 ? setQIndex(p=>p+1) : handleLevelComplete(); }, 1000); }
                else { setFeedback('wrong'); setLives(l=>l-1); setTimeout(() => setFeedback(null), 800); }
            };
            return (
                <div className="w-full max-w-md animate-fadeIn">
                    <div className="bg-white p-6 rounded-2xl border-t-8 border-red-500 mb-6 text-center"><p className="text-lg font-medium">{data.q.replace('______', '___?___')}</p>{feedback === 'wrong' && <p className="text-red-500 text-xs mt-2">{data.hint}</p>}</div>
                    <div className="grid gap-3">{options.map((opt,i) => <button key={i} onClick={() => handleAnswer(opt)} className="bg-blue-600 text-white font-bold py-3 px-6 rounded-lg shadow">{opt}</button>)}</div>
                </div>
            );
        };

        const App = () => {
            const [view, setView] = useState('home');
            const [level, setLevel] = useState(1);
            const [coins, setCoins] = useState(0);
            const [lives, setLives] = useState(3);
            const [unlocked, setUnlocked] = useState([1]);

            // ÁßªÈô§Âä†ËΩΩÂä®Áîª
            useEffect(() => { document.getElementById('loading').style.display = 'none'; }, []);

            // ÂÖ≥Âç°ÂÆåÊàêÈÄªËæë
            const handleLevelComplete = () => {
                const next = level + 1;
                if(!unlocked.includes(next)) setUnlocked([...unlocked, next]);
                if(level === 4) setUnlocked([...unlocked, 'done']);
                setView('victory');
            };

            const commonProps = { qIndex:0, setQIndex:()=>{}, feedback:null, setFeedback:()=>{}, coins, setCoins, setLives, handleLevelComplete }; 

            const LevelWrapper = () => {
                const [q, setQ] = useState(0);
                const [fb, setFb] = useState(null);
                
                useEffect(() => { setQ(0); setFb(null); }, [level]);

                const props = { qIndex: q, setQIndex: setQ, feedback: fb, setFeedback: setFb, setCoins, setLives, handleLevelComplete };

                if (lives <= 0) return (
                    <div className="text-center animate-bounce-in">
                        <div className="text-6xl mb-4">üíî</div><h2 className="text-2xl font-bold text-red-600">Game Over</h2>
                        <button onClick={() => { setLives(3); setQ(0); }} className="bg-blue-500 text-white px-6 py-2 rounded mt-4">Try Again</button>
                    </div>
                );

                return (
                    <div className="h-full flex flex-col w-full relative">
                        <div className="flex justify-between p-4 bg-white shadow z-10">
                            <button onClick={() => setView('map')} className="text-gray-500">EXIT</button>
                            <div className="font-bold text-indigo-800">Level {level}</div>
                            <div className="flex gap-2 text-yellow-600"><Icon name="Star" size={18}/> {coins} <Icon name="Heart" size={18} className="text-red-500"/> {lives}</div>
                        </div>
                        <div className="flex-1 flex justify-center items-center p-4 bg-slate-50 overflow-y-auto">
                            {level === 1 && <PhonicsGame {...props} />}
                            {level === 2 && <VocabGame {...props} />}
                            {level === 3 && <PhraseGame {...props} />}
                            {level === 4 && <GrammarBoss {...props} />}
                        </div>
                    </div>
                );
            };

            return (
                <div className="w-full h-full max-w-md bg-white shadow-xl overflow-hidden relative">
                    {view === 'home' && (
                        <div className="h-full flex flex-col items-center justify-center p-6 space-y-6 animate-fadeIn">
                            <div className="text-orange-500 scale-150"><Icon name="Sun" size={64} /></div>
                            <h1 className="text-3xl font-bold text-blue-900 text-center">Unit 5 Adventure</h1>
                            <div className="flex flex-col gap-3 w-full">
                                <button onClick={() => setView('review')} className="p-4 border-2 rounded-xl font-bold text-indigo-600 flex justify-center items-center gap-2"><Icon name="BookOpen"/> ËÆ≠ÁªÉËê• (Review)</button>
                                <button onClick={() => setView('map')} className="p-4 bg-yellow-400 rounded-xl font-bold text-white flex justify-center items-center gap-2 shadow-lg"><Icon name="Play"/> ÂºÄÂßãÂÜíÈô© (Start)</button>
                            </div>
                        </div>
                    )}

                    {view === 'review' && <ReviewScreen onFinish={() => setView('map')} />}

                    {view === 'map' && (
                        <div className="h-full flex flex-col p-6 bg-indigo-50 animate-fadeIn">
                            <div className="flex justify-between mb-6">
                                <button onClick={() => setView('home')}>HOME</button>
                                <div className="flex gap-1 items-center bg-white px-3 rounded-full text-yellow-600"><Icon name="Star" size={16}/> {coins}</div>
                            </div>
                            <div className="text-center mb-8"><h2 className="text-2xl font-bold text-indigo-900">Adventure Map</h2><p className="text-indigo-400 text-sm">Select a level to start</p></div>
                            <div className="flex-1 space-y-4 overflow-y-auto">
                                {[{id:1,n:'ËØ≠Èü≥Ê£ÆÊûó',i:'Mic'},{id:2,n:'ÂçïËØçÂ≥°Ë∞∑',i:'Sun'},{id:3,n:'Âè•Â≠êÊ≤≥ÊµÅ',i:'Wind'},{id:4,n:'ËØ≠Ê≥ïÈ´òÂ±±',i:'Phone'}].map(l => (
                                    <button key={l.id} disabled={!unlocked.includes(l.id)} onClick={() => { setLevel(l.id); setView('game'); }} className={`w-full p-4 rounded-xl flex items-center gap-4 ${unlocked.includes(l.id) ? 'bg-white shadow' : 'bg-gray-200 opacity-50'}`}>
                                        <div className={`p-3 rounded-full ${unlocked.includes(l.id+1) || unlocked.includes('done') ? 'bg-green-100 text-green-600' : 'bg-indigo-100 text-indigo-600'}`}>
                                            {unlocked.includes(l.id+1) || unlocked.includes('done') ? <Icon name="Check"/> : <Icon name={l.i}/>}
                                        </div>
                                        <div className="text-left flex-1 font-bold">{l.n}</div>
                                        {!unlocked.includes(l.id) && <Icon name="Lock" className="text-gray-400"/>}
                                    </button>
                                ))}
                            </div>
                        </div>
                    )}

                    {view === 'game' && <LevelWrapper />}

                    {view === 'victory' && (
                        <div className="h-full flex flex-col items-center justify-center p-8 bg-yellow-50 animate-bounce-in">
                            <div className="text-yellow-500 mb-4 scale-150"><Icon name="Trophy" size={64} /></div>
                            <h2 className="text-3xl font-bold mb-4">ÂÖ≥Âç°ÂÆåÊàê!</h2>
                            <div className="bg-white p-6 rounded-xl shadow w-full mb-6">
                                <div className="flex justify-between mb-2"><span>Ëé∑ÂæóÈáëÂ∏Å</span><span className="font-bold text-yellow-600">+{coins}</span></div>
                            </div>
                            <button onClick={() => setView('map')} className="px-8 py-3 bg-green-500 text-white rounded-full font-bold shadow-lg">ÁªßÁª≠ÂÜíÈô©</button>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    } catch (e) {
        document.getElementById('loading').style.display = 'none';
        document.getElementById('error-box').style.display = 'block';
        document.getElementById('error-msg').innerText = e.toString();
    }
    </script>
</body>
</html>
