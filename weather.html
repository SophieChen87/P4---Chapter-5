<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Unit 5 Weather Adventure</title>
    <!-- ä½¿ç”¨å›½å†…ç¨³å®šçš„ Staticfile CDN åŠ é€ŸåŠ è½½ -->
    <script src="https://cdn.staticfile.org/tailwindcss/3.3.5/tailwind.min.js"></script>
    <script crossorigin src="https://cdn.staticfile.org/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdn.staticfile.org/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.staticfile.org/babel-standalone/7.23.5/babel.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;800&display=swap');
        body { font-family: 'Nunito', sans-serif; touch-action: manipulation; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fadeIn { animation: fadeIn 0.5s ease-out forwards; }
        
        @keyframes bounceIn { 
            0% { opacity: 0; transform: scale(0.3); } 
            50% { opacity: 1; transform: scale(1.05); } 
            70% { transform: scale(0.9); } 
            100% { transform: scale(1); } 
        }
        .animate-bounce-in { animation: bounceIn 0.6s cubic-bezier(0.215, 0.610, 0.355, 1.000) both; }
        
        @keyframes pulse-slow {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        .animate-pulse-slow { animation: pulse-slow 3s infinite; }

        /* Loading Spinner */
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-slate-100 text-slate-800 h-screen w-screen overflow-hidden flex items-center justify-center">

    <!-- Loading / Error UI -->
    <div id="loading-container" class="fixed inset-0 flex flex-col items-center justify-center bg-white z-50">
        <div class="loader mb-4"></div>
        <p class="text-gray-600 font-bold">æ­£åœ¨åŠ è½½æ¸¸æˆèµ„æº...</p>
        <p class="text-xs text-gray-400 mt-2">é¦–æ¬¡åŠ è½½å¯èƒ½éœ€è¦å‡ ç§’é’Ÿ</p>
    </div>

    <div id="error-container" class="hidden fixed inset-0 flex-col items-center justify-center bg-red-50 z-50 p-6 text-center">
        <h2 class="text-2xl font-bold text-red-600 mb-2">å‡ºé”™äº† (Error)</h2>
        <p id="error-message" class="text-red-800 text-sm font-mono bg-red-100 p-4 rounded border border-red-200 w-full max-w-md break-words"></p>
        <button onclick="location.reload()" class="mt-4 px-4 py-2 bg-red-600 text-white rounded shadow">åˆ·æ–°é¡µé¢ (Reload)</button>
    </div>

    <div id="root" class="w-full h-full flex justify-center items-center"></div>

    <!-- Error Handling Script -->
    <script>
        window.onerror = function(message, source, lineno, colno, error) {
            document.getElementById('loading-container').style.display = 'none';
            document.getElementById('error-container').style.display = 'flex';
            document.getElementById('error-message').innerText = message + "\nLine: " + lineno;
        };
    </script>

    <script type="text/babel">
        try {
            const { useState, useEffect, useMemo, useCallback } = React;

            // --- ICONS (SVG Components - Strictly Checked) ---
            const Icon = ({ path, className, size = 24, fill = "none" }) => (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill={fill} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    {path}
                </svg>
            );

            const Icons = {
                Sun: (props) => <Icon {...props} path={<><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></>} />,
                Cloud: (props) => <Icon {...props} path={<path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242" />} />,
                CloudRain: (props) => <Icon {...props} path={<><path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242"/><path d="M16 14v6"/><path d="M8 14v6"/><path d="M12 16v6"/></>} />,
                Wind: (props) => <Icon {...props} path={<><path d="M17.7 7.7a2.5 2.5 0 1 1 1.8 4.3H2"/><path d="M9.6 4.6A2 2 0 1 1 11 8H2"/><path d="M12.6 19.4A2 2 0 1 0 14 16H2"/></>} />,
                Snowflake: (props) => <Icon {...props} path={<><line x1="2" y1="12" x2="22" y2="12"/><line x1="12" y1="2" x2="12" y2="22"/><path d="m20 16-4-4 4-4"/><path d="m4 8 4 4-4 4"/><path d="m16 4-4 4-4-4"/><path d="m8 20 4-4 4 4"/></>} />,
                Phone: (props) => <Icon {...props} path={<path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>} />,
                Mic: (props) => <Icon {...props} path={<><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></>} />,
                Star: (props) => <Icon {...props} path={<polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>} />,
                Lock: (props) => <Icon {...props} path={<><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></>} />,
                Play: (props) => <Icon {...props} path={<polygon points="5 3 19 12 5 21 5 3"/>} />,
                Trophy: (props) => <Icon {...props} path={<><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></>} />,
                Heart: (props) => <Icon {...props} path={<path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/>} />,
                ArrowRight: (props) => <Icon {...props} path={<><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></>} />,
                Check: (props) => <Icon {...props} path={<polyline points="20 6 9 17 4 12"/>} />,
                X: (props) => <Icon {...props} path={<><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></>} />,
                Volume2: (props) => <Icon {...props} path={<><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/></>} />,
                Thermometer: (props) => <Icon {...props} path={<path d="M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z"/>} />,
                Calendar: (props) => <Icon {...props} path={<><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></>} />,
                MapPin: (props) => <Icon {...props} path={<><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></>} />,
                Film: (props) => <Icon {...props} path={<><rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18"/><line x1="7" y1="2" x2="7" y2="22"/><line x1="17" y1="2" x2="17" y2="22"/><line x1="2" y1="12" x2="22" y2="12"/><line x1="2" y1="7" x2="7" y2="7"/><line x1="2" y1="17" x2="7" y2="17"/><line x1="17" y1="17" x2="22" y2="17"/><line x1="17" y1="7" x2="22" y2="7"/></>} />,
                Plane: (props) => <Icon {...props} path={<path d="M2 12h5l3 5v5l5-5h5a2 2 0 0 0 0-4h-5l-5-5v5l-3 5H2Z"/>} />,
                Frown: (props) => <Icon {...props} path={<><circle cx="12" cy="12" r="10"/><path d="M16 16s-1.5-2-4-2-4 2-4 2"/><line x1="9" y1="9" x2="9.01" y2="9"/><line x1="15" y1="9" x2="15.01" y2="9"/></>} />,
                Umbrella: (props) => <Icon {...props} path={<><path d="M22 12a10.06 10.06 0 0 0-20 0Z"/><path d="M12 12v8a2 2 0 0 0 4 0"/></>} />,
                Droplets: (props) => <Icon {...props} path={<><path d="M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.8-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z"/><path d="M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97"/></>} />,
                BookOpen: (props) => <Icon {...props} path={<><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></>} />,
                MessageCircle: (props) => <Icon {...props} path={<path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/>} />,
                User: (props) => <Icon {...props} path={<><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></>} />,
                Feather: (props) => <Icon {...props} path={<><path d="M20.24 12.24a6 6 0 0 0-8.49-8.49L5 10.5V19h8.5z"/><line x1="16" y1="8" x2="2" y2="22"/><line x1="17.5" y1="15" x2="9" y2="15"/></>} />,
                Music: (props) => <Icon {...props} path={<><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></>} />,
                Book: (props) => <Icon {...props} path={<><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></>} />,
                Shield: (props) => <Icon {...props} path={<path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>} />,
                Zap: (props) => <Icon {...props} path={<polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>} />
            };

            // --- DATA & UTILS ---
            const shuffleArray = (array) => {
                const newArray = [...array];
                for (let i = newArray.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
                }
                return newArray;
            };

            const speak = (text) => {
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'en-US';
                utterance.rate = 0.9;
                window.speechSynthesis.speak(utterance);
            };

            const level1Data = [
                { type: 'voiced', symbol: '/Ã°/', target: 'these', distractors: ['three', 'think', 'thumb'], question: 'Which word has the voiced /Ã°/ sound?' },
                { type: 'unvoiced', symbol: '/Î¸/', target: 'think', distractors: ['this', 'father', 'they'], question: 'Which word has the unvoiced /Î¸/ sound?' },
                { type: 'voiced', symbol: '/Ã°/', target: 'father', distractors: ['both', 'thing', 'thank'], question: 'Find the buzzing /Ã°/ sound:' },
                { type: 'unvoiced', symbol: '/Î¸/', target: 'three', distractors: ['there', 'their', 'weather'], question: 'Find the soft /Î¸/ sound:' },
                { type: 'voiced', symbol: '/Ã°/', target: 'they', distractors: ['thank', 'thumb', 'thin'], question: 'Select the word starting with /Ã°/:' },
                { type: 'voiced', symbol: '/Ã°/', target: 'there', distractors: ['three', 'birthday', 'math'], question: 'Which word sounds like "father"?' },
                { type: 'unvoiced', symbol: '/Î¸/', target: 'both', distractors: ['brother', 'that', 'smooth'], question: 'Which word ends with soft /Î¸/?' },
                { type: 'unvoiced', symbol: '/Î¸/', target: 'thing', distractors: ['this', 'those', 'mother'], question: 'Select the unvoiced /Î¸/ word:' },
                { type: 'voiced', symbol: '/Ã°/', target: 'brother', distractors: ['birthday', 'month', 'think'], question: 'Find the middle /Ã°/ sound:' },
                { type: 'unvoiced', symbol: '/Î¸/', target: 'thank', distractors: ['that', 'than', 'them'], question: 'Which is an unvoiced /Î¸/ word?' },
                { type: 'voiced', symbol: '/Ã°/', target: 'mother', distractors: ['mouth', 'math', 'three'], question: 'Which word has the voiced /Ã°/?' },
                { type: 'unvoiced', symbol: '/Î¸/', target: 'math', distractors: ['mother', 'smooth', 'weather'], question: 'Find the word ending in /Î¸/:' },
                { type: 'voiced', symbol: '/Ã°/', target: 'that', distractors: ['thin', 'thick', 'thumb'], question: 'Select the voiced /Ã°/ word:' },
                { type: 'unvoiced', symbol: '/Î¸/', target: 'thin', distractors: ['this', 'then', 'the'], question: 'Opposite of thick. Starts with /Î¸/:' },
                { type: 'voiced', symbol: '/Ã°/', target: 'those', distractors: ['thumb', 'thirteen', 'thought'], question: 'Plural of "that". Starts with /Ã°/:' },
                { type: 'unvoiced', symbol: '/Î¸/', target: 'birthday', distractors: ['brother', 'father', 'feather'], question: 'Find the soft /Î¸/ in the middle:' },
                { type: 'voiced', symbol: '/Ã°/', target: 'weather', distractors: ['thing', 'path', 'south'], question: 'Which word has the buzzing /Ã°/?' },
                { type: 'unvoiced', symbol: '/Î¸/', target: 'mouth', distractors: ['mother', 'smooth', 'breathe'], question: 'Body part with soft /Î¸/:' },
                { type: 'voiced', symbol: '/Ã°/', target: 'feather', distractors: ['teeth', 'health', 'north'], question: 'Light as a... (Voiced /Ã°/):' },
                { type: 'unvoiced', symbol: '/Î¸/', target: 'thirty', distractors: ['there', 'thy', 'worthy'], question: 'Number word with unvoiced /Î¸/:' },
            ];

            const level2Data = [
                { word: 'sunny', cn: 'é˜³å…‰å……è¶³çš„', icon: <Icons.Sun className="text-orange-500" />, type: 'adj' },
                { word: 'snowy', cn: 'å¤šé›ªçš„', icon: <Icons.Snowflake className="text-blue-300" />, type: 'adj' },
                { word: 'windy', cn: 'å¤šé£çš„', icon: <Icons.Wind className="text-gray-400" />, type: 'adj' },
                { word: 'rainy', cn: 'é˜´é›¨çš„', icon: <Icons.CloudRain className="text-blue-600" />, type: 'adj' },
                { word: 'cloudy', cn: 'å¤šäº‘çš„', icon: <Icons.Cloud className="text-gray-500" />, type: 'adj' },
                { word: 'hot', cn: 'çƒ­çš„', icon: <Icons.Sun className="text-red-500" />, type: 'adj' },
                { word: 'cold', cn: 'å†·çš„', icon: <Icons.Thermometer className="text-blue-500" />, type: 'adj' },
                { word: 'cool', cn: 'å‡‰çˆ½çš„', icon: <Icons.Wind className="text-cyan-400" />, type: 'adj' },
                { word: 'warm', cn: 'æ¸©æš–çš„', icon: <Icons.Sun className="text-yellow-400" />, type: 'adj' },
                { word: 'bad', cn: 'åçš„; ä»¤äººä¸å¿«çš„', icon: <Icons.Frown className="text-gray-600" />, type: 'adj' },
                { word: 'tomorrow', cn: 'åœ¨æ˜å¤©', icon: <Icons.Calendar className="text-purple-500" />, type: 'time' },
                { word: 'Sydney', cn: 'æ‚‰å°¼', icon: <Icons.MapPin className="text-red-600" />, type: 'place' },
                { word: 'closed', cn: 'å…³é—­çš„', icon: <Icons.Lock className="text-gray-700" />, type: 'status' },
                { word: 'film', cn: 'ç”µå½±', icon: <Icons.Film className="text-indigo-600" />, type: 'noun' },
                { word: 'fly', cn: 'é£; æ“çºµ', icon: <Icons.Plane className="text-sky-500" />, type: 'verb' },
                { word: 'swim', cn: 'æ¸¸æ³³', icon: <Icons.Droplets className="text-blue-400" />, type: 'verb' },
                { word: 'weather', cn: 'å¤©æ°”', icon: <Icons.Cloud className="text-blue-300" />, type: 'noun' },
                { word: 'kite', cn: 'é£ç­', icon: <Icons.Wind className="text-orange-400" />, type: 'noun' },
                { word: 'snowman', cn: 'é›ªäºº', icon: <Icons.User className="text-white bg-blue-200 rounded-full" />, type: 'noun' },
                { word: 'speak', cn: 'è¯´è¯; å‘è¨€', icon: <Icons.MessageCircle className="text-green-500" />, type: 'verb' },
            ];

            const level3Data = [
                { weather: 'Itâ€™s cold and rainy.', scenario: 'We canâ€™t play football.', correct: 'make a card', wrong: 'fly a kite', question: 'What can we do inside?' },
                { weather: 'Itâ€™s snowy.', scenario: 'Letâ€™s go outside!', correct: 'make a snowman', wrong: 'swim', question: 'What is a good winter activity?' },
                { weather: 'Itâ€™s warm and sunny.', scenario: 'The park is open.', correct: 'fly a kite', wrong: 'see a film', question: 'Best activity for a windy sunny day?' },
                { weather: 'Itâ€™s bad weather.', scenario: 'We canâ€™t go out.', correct: 'see a film', wrong: 'water the flowers', question: 'What to do at home?' },
                { weather: 'Itâ€™s sunny and hot.', scenario: 'The flowers are dry.', correct: 'water the flowers', wrong: 'make a snowman', question: 'What should we do in the garden?' },
                { weather: 'Itâ€™s a rainy afternoon.', scenario: 'I want to read books.', correct: 'go to the library', wrong: 'go to the park', question: 'Where should we go?' },
                { weather: 'Itâ€™s cool and sunny.', scenario: 'Let\'s do sports!', correct: 'play basketball', wrong: 'see a film', question: 'What sport can we play outside?' },
                { weather: 'Itâ€™s 30 degrees (Hot).', scenario: 'I want to be cool.', correct: 'swim', wrong: 'make a snowman', question: 'What is a good summer activity?' },
                { weather: 'Itâ€™s rainy outside.', scenario: 'I don\'t want to get wet.', correct: 'take an umbrella', wrong: 'wear sunglasses', question: 'What should you take?' },
                { weather: 'Itâ€™s windy.', scenario: 'My hat is flying away.', correct: 'hold your hat', wrong: 'open an umbrella', question: 'What should you do?' },
                { weather: 'Itâ€™s very cold.', scenario: 'I\'m going out.', correct: 'wear a coat', wrong: 'wear a t-shirt', question: 'Dress for the weather:' },
                { weather: 'Itâ€™s sunny.', scenario: 'The sun is bright.', correct: 'wear sunglasses', wrong: 'wear rainboots', question: 'Protect your eyes:' },
                { weather: 'Itâ€™s snowing.', scenario: 'The ground is white.', correct: 'play in the snow', wrong: 'swim in the sea', question: 'Fun activity?' },
                { weather: 'Can we go to the park?', scenario: 'It\'s raining hard.', correct: 'No, we can\'t.', wrong: 'Yes, we can.', question: 'Logical answer:' },
                { weather: 'Can we make a snowman?', scenario: 'It\'s hot and sunny.', correct: 'No, we can\'t.', wrong: 'Yes, we can.', question: 'Logical answer:' },
                { weather: 'It\'s cloudy.', scenario: 'It might rain soon.', correct: 'take a raincoat', wrong: 'wear shorts', question: 'Be prepared:' },
                { weather: 'Sydney is hot.', scenario: 'I am in Sydney.', correct: 'I can swim.', wrong: 'I can make a snowman.', question: 'What can you do?' },
                { weather: 'London is rainy.', scenario: 'I am in London.', correct: 'I can read at home.', wrong: 'I can play football outside.', question: 'Activity choice:' },
                { weather: 'The library is closed.', scenario: 'I have a new book.', correct: 'read at home', wrong: 'go to the library', question: 'Logic check:' },
                { weather: 'The water is warm.', scenario: 'We are at the pool.', correct: 'swim', wrong: 'fly a kite', question: 'What activity matches?' },
            ];

            const level4Data = [
                { q: 'Hello! Mark ______.', options: ['speaking', 'talking', 'saying', 'calling'], answer: 'speaking', hint: 'Telephone rule: Name + speaking' },
                { q: 'Hi Mark! ______ is John.', options: ['This', 'I', 'He', 'Here'], answer: 'This', hint: 'Telephone rule: This is...' },
                { q: 'Whatâ€™s the weather ______ in Sydney?', options: ['like', 'love', 'look', 'likes'], answer: 'like', hint: 'Pattern: What\'s the weather like...?' },
                { q: 'We ______ play football because it is raining.', options: ['can\'t', 'can', 'do', 'are'], answer: 'can\'t', hint: 'Reasoning: Rain means no outdoor sports.' },
                { q: 'Can we ______ a kite?', options: ['fly', 'flying', 'flies', 'flew'], answer: 'fly', hint: 'Grammar: Can + Verb (base form)' },
                { q: 'It\'s cold ______ snowy.', options: ['and', 'but', 'or', 'so'], answer: 'and', hint: 'Connecting two similar descriptions.' },
                { q: 'Can I have ______ soup?', options: ['some', 'any', 'a', 'an'], answer: 'some', hint: 'Polite request uses "some".' },
                { q: 'Is that the weather report?', options: ['Yes, it is.', 'Yes, I am.', 'No, he isn\'t.', 'Yes, they are.'], answer: 'Yes, it is.', hint: 'Subject is "it".' },
                { q: 'It\'s ______ in Beijing.', options: ['sunny', 'sun', 'suns', 'sunned'], answer: 'sunny', hint: 'Use adjectives for weather.' },
                { q: 'Can you ______ a snowman?', options: ['make', 'making', 'makes', 'made'], answer: 'make', hint: 'Can + Base Verb' },
                { q: 'The library is ______.', options: ['closed', 'close', 'closing', 'closes'], answer: 'closed', hint: 'Adjective meaning not open.' },
                { q: 'What do you do ______ rainy days?', options: ['on', 'in', 'at', 'of'], answer: 'on', hint: 'Preposition for days.' },
                { q: 'It\'s hot inside. Can I ______ the window?', options: ['open', 'opens', 'opening', 'opened'], answer: 'open', hint: 'Can + Base Verb' },
                { q: '______ is the weather like?', options: ['What', 'How', 'Where', 'When'], answer: 'What', hint: 'What... like?' },
                { q: '______ is the weather?', options: ['How', 'What', 'Who', 'Which'], answer: 'How', hint: 'How is the weather? (No like)' },
                { q: 'Be careful! It\'s ______.', options: ['slippery', 'slip', 'slipped', 'slips'], answer: 'slippery', hint: 'Need an adjective.' },
                { q: 'Look at ______ clouds!', options: ['those', 'that', 'this', 'they'], answer: 'those', hint: 'Plural clouds -> those' },
                { q: 'Let\'s ______ home.', options: ['go', 'goes', 'going', 'gone'], answer: 'go', hint: 'Let\'s + Base Verb' },
                { q: 'Is it cold? No, it ______.', options: ['isn\'t', 'is', 'aren\'t', 'not'], answer: 'isn\'t', hint: 'Negative short answer.' },
                { q: 'Do you like ______ days?', options: ['rainy', 'rain', 'rains', 'raining'], answer: 'rainy', hint: 'Adjective describing days.' },
            ];

            // --- COMPONENTS ---

            const ReviewScreen = ({ onFinish }) => {
                const [activeTab, setActiveTab] = useState('map');

                const phonicsReview = useMemo(() => {
                    const voiced = [...new Set(level1Data.filter(d => d.type === 'voiced').map(d => d.target))];
                    const unvoiced = [...new Set(level1Data.filter(d => d.type === 'unvoiced').map(d => d.target))];
                    return { voiced, unvoiced };
                }, []);

                return (
                    <div className="h-full flex flex-col bg-slate-50 overflow-hidden">
                        <div className="bg-indigo-600 text-white p-4 shadow-md flex justify-between items-center z-10">
                            <h2 className="font-bold text-xl flex items-center gap-2"><Icons.BookOpen /> è®­ç»ƒè¥ (Training Camp)</h2>
                            <button onClick={onFinish} className="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-full font-bold text-sm flex items-center gap-1 transition-colors shadow-sm">
                                å‡†å¤‡å†’é™© (Ready) <Icons.ArrowRight size={16}/>
                            </button>
                        </div>

                        <div className="flex bg-white shadow-sm overflow-x-auto">
                            {[
                                { id: 'map', label: 'å•å…ƒè„‰ç»œ (Map)', icon: <Icons.MapPin size={18}/> },
                                { id: 'phonics', label: 'è¯­éŸ³ (Phonics)', icon: <Icons.Mic size={18}/> },
                                { id: 'words', label: 'è¯æ±‡ (Words)', icon: <Icons.Shield size={18}/> },
                                { id: 'grammar', label: 'è¯­æ³• (Grammar)', icon: <Icons.Zap size={18}/> },
                            ].map(tab => (
                                <button
                                    key={tab.id}
                                    onClick={() => setActiveTab(tab.id)}
                                    className={`flex-1 min-w-[120px] p-3 text-sm font-bold flex flex-col items-center gap-1 border-b-4 transition-colors ${
                                        activeTab === tab.id ? 'border-indigo-600 text-indigo-700 bg-indigo-50' : 'border-transparent text-gray-500 hover:text-gray-700'
                                    }`}
                                >
                                    {tab.icon}
                                    {tab.label}
                                </button>
                            ))}
                        </div>

                        <div className="flex-1 overflow-y-auto p-6">
                            {activeTab === 'map' && (
                                <div className="space-y-6 animate-fadeIn">
                                    <div className="bg-blue-50 p-6 rounded-2xl border border-blue-100 text-center">
                                        <h3 className="text-xl font-bold text-blue-800 mb-2">Unit 5: The weather and us</h3>
                                        <p className="text-blue-600 italic">How does the weather affect people's lives?</p>
                                        <p className="text-sm text-gray-500 mt-1">å¤©æ°”å¦‚ä½•å½±å“äººä»¬çš„ç”Ÿæ´»ï¼Ÿ</p>
                                    </div>
                                    <div className="grid md:grid-cols-2 gap-4">
                                        <div className="bg-white p-5 rounded-xl shadow-sm border-l-4 border-orange-400">
                                            <h4 className="font-bold text-lg text-orange-600 mb-2 flex items-center gap-2"><Icons.Sun size={20}/> Part A: å¤©æ°” (Weather)</h4>
                                            <ul className="text-sm space-y-2 text-gray-700">
                                                <li>â€¢ Different places have different weather.<br/><span className="text-gray-500 text-xs">ä¸åŒåœ°æ–¹æœ‰ä¸åŒçš„å¤©æ°”ã€‚</span></li>
                                                <li>â€¢ Use adjectives: sunny, rainy, windy...<br/><span className="text-gray-500 text-xs">ä½¿ç”¨å½¢å®¹è¯æè¿°å¤©æ°”ã€‚</span></li>
                                                <li>â€¢ Key Question: "What's the weather like?"<br/><span className="text-gray-500 text-xs">æ ¸å¿ƒé—®å¥ï¼šå¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ</span></li>
                                            </ul>
                                        </div>
                                        <div className="bg-white p-5 rounded-xl shadow-sm border-l-4 border-green-400">
                                            <h4 className="font-bold text-lg text-green-600 mb-2 flex items-center gap-2"><Icons.User size={20}/> Part B: æ´»åŠ¨ (Activities)</h4>
                                            <ul className="text-sm space-y-2 text-gray-700">
                                                <li>â€¢ Weather decides what we do.<br/><span className="text-gray-500 text-xs">å¤©æ°”å†³å®šæˆ‘ä»¬åšä»€ä¹ˆã€‚</span></li>
                                                <li>â€¢ Good weather â†’ Outdoor activities (fly a kite)<br/><span className="text-gray-500 text-xs">å¥½å¤©æ°” â†’ æˆ·å¤–æ´»åŠ¨ (å¦‚æ”¾é£ç­)</span></li>
                                                <li>â€¢ Bad weather â†’ Indoor activities (read a book)<br/><span className="text-gray-500 text-xs">åå¤©æ°” â†’ å®¤å†…æ´»åŠ¨ (å¦‚çœ‹ä¹¦)</span></li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {activeTab === 'phonics' && (
                                <div className="space-y-6 animate-fadeIn">
                                    <div className="bg-yellow-50 p-4 rounded-lg text-sm text-yellow-800 border border-yellow-200">
                                        ğŸ’¡ <strong>Tip:</strong> ç‚¹å‡»å•è¯å¬å¬çœ‹åŒºåˆ«ï¼æ³¨æ„å’¬èˆŒå°–ã€‚
                                    </div>
                                    <div className="grid md:grid-cols-2 gap-6">
                                        <div className="bg-white p-4 rounded-xl shadow-sm border-t-4 border-red-400">
                                            <h3 className="text-lg font-bold text-red-600 mb-3 flex items-center justify-between">
                                                <span>/Ã°/ æµŠè¾…éŸ³ (å£°å¸¦æŒ¯åŠ¨)</span>
                                                <Icons.Mic className="opacity-20"/>
                                            </h3>
                                            <p className="text-xs text-gray-500 mb-2">åƒèœœèœ‚å—¡å—¡å«ï¼Œæ‘¸å–‰å’™ä¼šéœ‡åŠ¨ã€‚</p>
                                            <div className="flex flex-wrap gap-2">
                                                {phonicsReview.voiced.map(word => (
                                                    <button key={word} onClick={() => speak(word)} className="px-3 py-1 bg-red-50 text-red-700 rounded-full text-sm hover:bg-red-100 transition-colors">{word}</button>
                                                ))}
                                            </div>
                                        </div>
                                        <div className="bg-white p-4 rounded-xl shadow-sm border-t-4 border-blue-400">
                                            <h3 className="text-lg font-bold text-blue-600 mb-3 flex items-center justify-between">
                                                <span>/Î¸/ æ¸…è¾…éŸ³ (åªæœ‰æ°”æµ)</span>
                                                <Icons.Mic className="opacity-20"/>
                                            </h3>
                                            <p className="text-xs text-gray-500 mb-2">è½»è½»å¹æ°”ï¼Œå£°å¸¦ä¸éœ‡åŠ¨ã€‚</p>
                                            <div className="flex flex-wrap gap-2">
                                                {phonicsReview.unvoiced.map(word => (
                                                    <button key={word} onClick={() => speak(word)} className="px-3 py-1 bg-blue-50 text-blue-700 rounded-full text-sm hover:bg-blue-100 transition-colors">{word}</button>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {activeTab === 'words' && (
                                <div className="animate-fadeIn">
                                    <div className="text-center mb-4 text-gray-500 text-sm">ç‚¹å‡»å•è¯å¯æœ—è¯» (Tap to speak)</div>
                                    <div className="grid grid-cols-2 md:grid-cols-3 gap-3">
                                        {level2Data.map((item, idx) => (
                                            <div key={idx} onClick={() => speak(item.word)} className="bg-white p-3 rounded-xl shadow-sm border hover:border-indigo-300 cursor-pointer flex flex-col items-center text-center transition-all">
                                                <div className="text-indigo-500 mb-1">{item.icon}</div>
                                                <div className="font-bold text-gray-800">{item.word}</div>
                                                <div className="text-xs text-gray-500">{item.cn}</div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {activeTab === 'grammar' && (
                                <div className="space-y-4 animate-fadeIn">
                                    <div className="bg-white p-5 rounded-xl shadow-sm border-l-4 border-indigo-500">
                                        <h4 className="font-bold text-indigo-700 mb-2">1. è¯¢é—®å¤©æ°” (Asking about Weather)</h4>
                                        <div className="bg-slate-100 p-3 rounded text-sm space-y-1 font-mono text-slate-700">
                                            <p>Q: What's the weather like?</p>
                                            <p className="text-gray-400 text-xs mb-2">å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ</p>
                                            <p>A: It's sunny / rainy / windy.</p>
                                            <p className="text-gray-400 text-xs">æ˜¯æ™´å¤©/é›¨å¤©/å¤šé£çš„ã€‚</p>
                                        </div>
                                    </div>
                                    <div className="bg-white p-5 rounded-xl shadow-sm border-l-4 border-pink-500">
                                        <h4 className="font-bold text-pink-700 mb-2">2. ç”µè¯ç”¨è¯­ (Telephone English)</h4>
                                        <div className="bg-slate-100 p-3 rounded text-sm space-y-1 font-mono text-slate-700">
                                            <p>âŒ I am Mark. (æˆ‘æ˜¯Mark - é”™è¯¯)</p>
                                            <p>âœ… This is Mark. (æˆ‘æ˜¯Mark)</p>
                                            <p>âœ… Mark speaking. (æˆ‘æ˜¯Markï¼Œæ­£åœ¨è¯´è¯)</p>
                                        </div>
                                    </div>
                                    <div className="bg-white p-5 rounded-xl shadow-sm border-l-4 border-purple-500">
                                        <h4 className="font-bold text-purple-700 mb-2">3. æƒ…æ€åŠ¨è¯ Can (Can + Verb)</h4>
                                        <div className="bg-slate-100 p-3 rounded text-sm space-y-1 font-mono text-slate-700">
                                            <p>We can <strong>swim</strong>.</p>
                                            <p>We can't <strong>play</strong> football.</p>
                                            <div className="mt-2 p-2 bg-red-50 text-red-600 text-xs border border-red-200 rounded">
                                                âš ï¸ <strong>é‡ç‚¹ï¼š</strong> can/can't åé¢å¿…é¡»åŠ åŠ¨è¯åŸå½¢ï¼<br/>(ä¸èƒ½åŠ  s, ing, ed, to)
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                );
            };

            const PhonicsGame = ({ qIndex, setQIndex, setFeedback, feedback, setCoins, setLives, handleLevelComplete }) => {
                const currentQ = level1Data[qIndex];
                const options = useMemo(() => shuffleArray([currentQ.target, ...currentQ.distractors]), [currentQ]);

                const handleAnswer = (word) => {
                    if(feedback) return;
                    const isCorrect = word === currentQ.target;
                    if (isCorrect) {
                        setFeedback('correct'); speak("Correct!"); setCoins(c => c + 10);
                        setTimeout(() => { setFeedback(null); if (qIndex < level1Data.length - 1) setQIndex(p => p + 1); else handleLevelComplete(); }, 1500);
                    } else {
                        setFeedback('wrong'); speak("Try again."); setLives(l => l - 1); setTimeout(() => setFeedback(null), 1000);
                    }
                };

                return (
                    <div className="w-full max-w-md animate-fadeIn">
                        <div className="text-center mb-6">
                            <span className={`inline-block px-4 py-1 rounded-full text-sm font-bold mb-4 ${currentQ.symbol === '/Ã°/' ? 'bg-red-100 text-red-600' : 'bg-blue-100 text-blue-600'}`}>Target Sound: {currentQ.symbol} {currentQ.type}</span>
                            <h3 className="text-xl font-bold text-gray-800">{currentQ.question}</h3>
                            <p className="text-sm text-gray-400 mt-2">Question {qIndex + 1} / {level1Data.length}</p>
                        </div>
                        <div className="grid grid-cols-1 gap-3">
                            {options.map((word, i) => (
                                <button key={i} onClick={() => { speak(word); handleAnswer(word); }} className={`p-4 rounded-xl border-2 font-bold text-lg flex items-center justify-between transition-all transform hover:scale-105 ${feedback === 'correct' && word === currentQ.target ? 'bg-green-100 border-green-500 text-green-700' : feedback === 'wrong' && word !== currentQ.target ? 'bg-white border-gray-200 opacity-50' : 'bg-white border-gray-200 hover:border-blue-300'}`}>
                                    <span className="flex items-center gap-2"><Icons.Volume2 size={18}/> {word}</span>
                                    {feedback === 'correct' && word === currentQ.target && <Icons.Check />}
                                </button>
                            ))}
                        </div>
                    </div>
                );
            };

            const VocabGame = ({ qIndex, setQIndex, setFeedback, feedback, setCoins, setLives, handleLevelComplete }) => {
                const currentWord = level2Data[qIndex];
                const allOptions = useMemo(() => shuffleArray([...shuffleArray(level2Data.filter(d => d.word !== currentWord.word)).slice(0, 3), currentWord]), [currentWord]);

                const handleAnswer = (option) => {
                    if(feedback) return;
                    if (option.word === currentWord.word) {
                        setFeedback('correct'); speak(currentWord.word); setCoins(c => c + 10);
                        setTimeout(() => { setFeedback(null); if (qIndex < level2Data.length - 1) setQIndex(p => p + 1); else handleLevelComplete(); }, 1000);
                    } else {
                        setFeedback('wrong'); setLives(l => l - 1); setTimeout(() => setFeedback(null), 800);
                    }
                };

                return (
                    <div className="w-full max-w-md text-center animate-fadeIn">
                        <div className="flex justify-between text-xs text-gray-400 mb-2 px-2"><span>Word Valley</span><span>{qIndex + 1} / {level2Data.length}</span></div>
                        <h3 className="text-gray-500 text-sm font-bold mb-2">WHAT IS THIS?</h3>
                        <div className="bg-white p-8 rounded-2xl shadow-lg mb-6 flex flex-col items-center justify-center h-48 border-b-4 border-blue-100">
                            <div className="scale-150 mb-4 transform transition-transform hover:scale-175 duration-300">{currentWord.icon}</div>
                            <h2 className="text-3xl font-extrabold text-gray-800">{currentWord.cn}</h2>
                            <p className="text-sm text-gray-400 mt-2">{currentWord.type}</p>
                        </div>
                        <div className="grid grid-cols-2 gap-3">
                            {allOptions.map((opt, i) => (
                                <button key={i} onClick={() => handleAnswer(opt)} className={`p-4 rounded-xl font-bold transition-all transform hover:scale-105 ${feedback === 'correct' && opt.word === currentWord.word ? 'bg-green-500 text-white shadow-lg' : feedback === 'wrong' ? 'bg-gray-100 opacity-50' : 'bg-white text-blue-900 shadow-sm hover:bg-blue-50'}`}>
                                    {opt.word}
                                </button>
                            ))}
                        </div>
                    </div>
                );
            };

            const PhraseGame = ({ qIndex, setQIndex, setFeedback, feedback, setCoins, setLives, handleLevelComplete }) => {
                const data = level3Data[qIndex];
                const options = useMemo(() => shuffleArray([{ text: data.correct, isCorrect: true }, { text: data.wrong, isCorrect: false }]), [data]);

                const handleAnswer = (isCorrect) => {
                    if(feedback) return;
                    if(isCorrect) {
                        setFeedback('correct'); setCoins(c => c + 15);
                        setTimeout(() => { setFeedback(null); if(qIndex < level3Data.length - 1) setQIndex(p => p + 1); else handleLevelComplete(); }, 1500);
                    } else {
                        setFeedback('wrong'); setLives(l => l - 1); setTimeout(() => setFeedback(null), 1000);
                    }
                };

                return (
                    <div className="w-full max-w-md animate-fadeIn">
                        <div className="text-right text-xs text-gray-400 mb-2">Mission {qIndex + 1} / {level3Data.length}</div>
                        <div className="bg-gradient-to-br from-indigo-500 to-purple-600 text-white p-6 rounded-2xl shadow-lg mb-6 relative overflow-hidden">
                            <div className="absolute top-0 right-0 p-4 opacity-20"><Icons.Wind size={100} /></div>
                            <div className="relative z-10"><h3 className="text-purple-200 text-xs font-bold uppercase tracking-wider mb-1">Situation</h3><p className="text-xl font-bold mb-2">{data.weather}</p><p className="text-lg opacity-90 italic">"{data.scenario}"</p></div>
                        </div>
                        <p className="text-center text-gray-600 font-bold mb-4">{data.question}</p>
                        <div className="space-y-3">
                            {options.map((opt, i) => (
                                <button key={i} onClick={() => handleAnswer(opt.isCorrect)} className={`w-full p-4 bg-white rounded-xl shadow-sm border-l-8 flex items-center justify-between hover:scale-105 transition-transform ${feedback === 'correct' && opt.isCorrect ? 'border-green-400 ring-2 ring-green-500' : feedback === 'wrong' && !opt.isCorrect ? 'border-red-300 opacity-50' : 'border-blue-200'}`}>
                                    <span className="font-bold text-gray-700">{opt.text}</span>
                                    {feedback === 'correct' && opt.isCorrect && <Icons.Check className="text-green-500"/>}
                                    {feedback === 'wrong' && !opt.isCorrect && <Icons.X className="text-red-500"/>}
                                </button>
                            ))}
                        </div>
                    </div>
                );
            };

            const GrammarBoss = ({ qIndex, setQIndex, setFeedback, feedback, setCoins, setLives, handleLevelComplete }) => {
                const data = level4Data[qIndex];
                const shuffledOptions = useMemo(() => shuffleArray(data.options), [data]);

                const handleAnswer = (val) => {
                    if(feedback) return;
                    if(val === data.answer) {
                        setFeedback('correct'); setCoins(c => c + 20);
                        setTimeout(() => { setFeedback(null); if(qIndex < level4Data.length - 1) setQIndex(p => p + 1); else handleLevelComplete(); }, 1500);
                    } else {
                        setFeedback('wrong'); setLives(l => l - 1); setTimeout(() => setFeedback(null), 1000);
                    }
                };

                return (
                    <div className="w-full max-w-md animate-fadeIn">
                        <div className="text-center mb-6">
                            <div className="inline-block p-3 bg-red-100 rounded-full mb-2"><div className="text-3xl">ğŸ‘¹</div></div>
                            <h2 className="text-red-600 font-extrabold text-2xl uppercase tracking-widest">Boss Battle</h2>
                            <p className="text-xs text-red-400 font-bold">Round {qIndex + 1} / {level4Data.length}</p>
                        </div>
                        <div className="bg-white p-6 rounded-2xl shadow-xl border-t-8 border-red-500 mb-6 text-center">
                            <p className="text-xl font-medium text-gray-800 leading-relaxed">
                                {data.q.split('______').map((part, i) => (
                                    <React.Fragment key={i}>{part}{i === 0 && <span className="inline-block w-24 border-b-2 border-black mx-1 animate-pulse bg-gray-100 rounded text-transparent">?</span>}</React.Fragment>
                                ))}
                            </p>
                            {feedback === 'wrong' && <p className="text-red-500 text-xs mt-3 bg-red-50 p-2 rounded">{data.hint}</p>}
                        </div>
                        <div className="grid grid-cols-1 gap-3">
                            {shuffledOptions.map((opt, i) => (
                                <button key={i} onClick={() => handleAnswer(opt)} className="bg-blue-600 text-white font-bold py-3 px-6 rounded-lg shadow hover:bg-blue-700 hover:shadow-lg transition-all">{opt}</button>
                            ))}
                        </div>
                    </div>
                );
            };

            const GameLevelWrapper = ({ currentLevel, lives, coins, setCoins, setLives, setView, handleLevelComplete }) => {
                const [qIndex, setQIndex] = useState(0);
                const [feedback, setFeedback] = useState(null);
                useEffect(() => { setQIndex(0); setFeedback(null); }, [currentLevel]);
                const commonProps = { qIndex, setQIndex, setFeedback, feedback, setCoins, setLives, handleLevelComplete };

                return (
                    <div className="h-full flex flex-col bg-slate-50 relative">
                        <div className="bg-white p-4 shadow-sm flex justify-between items-center z-10">
                            <button onClick={() => setView('map')} className="text-gray-400 hover:text-gray-600 font-bold text-sm">EXIT</button>
                            <div className="font-bold text-lg text-indigo-800">Level {currentLevel}</div>
                            <div className="flex gap-3">
                                <div className="flex items-center text-red-500 font-bold gap-1"><Icons.Heart fill="currentColor" size={18}/> {lives}</div>
                                <div className="flex items-center text-yellow-500 font-bold gap-1"><Icons.Star fill="currentColor" size={18}/> {coins}</div>
                            </div>
                        </div>
                        <div className="flex-1 p-6 flex items-center justify-center overflow-y-auto">
                            {lives > 0 ? (
                                <>
                                    {currentLevel === 1 && <PhonicsGame {...commonProps} />}
                                    {currentLevel === 2 && <VocabGame {...commonProps} />}
                                    {currentLevel === 3 && <PhraseGame {...commonProps} />}
                                    {currentLevel === 4 && <GrammarBoss {...commonProps} />}
                                </>
                            ) : (
                                <div className="text-center animate-bounce-in">
                                    <div className="text-6xl mb-4">ğŸ’”</div>
                                    <h2 className="text-2xl font-bold text-red-600 mb-2">Game Over</h2>
                                    <p className="text-gray-600 mb-6">Don't give up! Try this level again.</p>
                                    <button onClick={() => { setLives(3); setQIndex(0); }} className="bg-blue-500 text-white px-6 py-3 rounded-full font-bold shadow-lg">Try Again</button>
                                </div>
                            )}
                        </div>
                    </div>
                );
            };

            const Unit5Adventure = () => {
                const [view, setView] = useState('home');
                const [currentLevel, setCurrentLevel] = useState(1);
                const [unlockedLevels, setUnlockedLevels] = useState([1]);
                const [coins, setCoins] = useState(0);
                const [lives, setLives] = useState(3);

                useEffect(() => {
                    // Hide loading spinner when component mounts
                    document.getElementById('loading-container').style.display = 'none';
                }, []);

                const handleLevelComplete = () => {
                    const nextLevel = currentLevel + 1;
                    let newUnlocked = [...unlockedLevels];
                    if (!newUnlocked.includes(nextLevel)) newUnlocked.push(nextLevel);
                    if (currentLevel === 4) newUnlocked.push('done');
                    setUnlockedLevels(newUnlocked);
                    setView('victory');
                };

                return (
                    <div className="w-full max-w-md h-full md:h-[90vh] md:max-h-[800px] bg-white md:rounded-3xl shadow-2xl overflow-hidden relative">
                        {view === 'home' && (
                            <div className="flex flex-col items-center justify-center h-full space-y-8 animate-fadeIn text-center p-6">
                                <div className="bg-blue-100 p-6 rounded-full shadow-xl mb-4"><Icons.Sun size={64} className="text-orange-500 animate-pulse-slow" /></div>
                                <div><h1 className="text-4xl font-extrabold text-blue-900 mb-2">Unit 5 Adventure</h1><p className="text-lg text-blue-600">The Weather Kingdom Needs You!</p></div>
                                <div className="bg-white p-4 rounded-xl shadow-md w-full max-w-sm">
                                    <div className="flex justify-between items-center text-sm text-gray-600 mb-2"><span>Daily Goal</span><span>{unlockedLevels.includes('done') ? 4 : unlockedLevels.length - 1}/4 Levels</span></div>
                                    <div className="w-full bg-gray-200 rounded-full h-2.5"><div className="bg-green-500 h-2.5 rounded-full" style={{ width: `${(unlockedLevels.length - 1) * 25}%` }}></div></div>
                                </div>
                                <div className="flex flex-col gap-4 w-full max-w-xs">
                                    <button onClick={() => setView('review')} className="group relative px-6 py-3 bg-white border-2 border-indigo-100 text-indigo-600 rounded-2xl shadow-sm hover:bg-indigo-50 transition-all font-bold flex items-center justify-center gap-2">
                                        <Icons.BookOpen size={20} /> Enter Training Camp (è¿›å…¥è®­ç»ƒè¥)
                                    </button>
                                    <button onClick={() => setView('map')} className="group relative px-8 py-4 bg-gradient-to-r from-yellow-400 to-orange-500 rounded-2xl shadow-lg hover:scale-105 transition-all text-white font-bold text-xl flex items-center justify-center gap-3">
                                        <Icons.Play fill="white" /> START ADVENTURE
                                    </button>
                                </div>
                                <p className="text-xs text-gray-400">Based onã€Šå®éªŒç­æä¼˜è®­ç»ƒã€‹Unit 5</p>
                            </div>
                        )}
                        {view === 'review' && <ReviewScreen onFinish={() => setView('map')} />}
                        {view === 'map' && (
                            <div className="flex flex-col h-full bg-indigo-50 p-6 overflow-y-auto animate-fadeIn">
                                <div className="flex justify-between items-center mb-8">
                                    <button onClick={() => setView('home')} className="text-indigo-400 font-bold text-sm">HOME</button>
                                    <div className="flex gap-4"><div className="flex items-center gap-1 bg-yellow-100 px-3 py-1 rounded-full text-yellow-700 font-bold"><Icons.Star size={16} fill="gold" className="text-yellow-500"/> {coins}</div></div>
                                </div>
                                <div className="text-center mb-8"><h2 className="text-2xl font-bold text-indigo-900">Adventure Map</h2><p className="text-indigo-400 text-sm">Select a level to start</p></div>
                                <div className="flex-1 flex flex-col items-center space-y-8 relative pb-20">
                                    <div className="absolute left-1/2 top-4 bottom-20 w-1 bg-indigo-200 -z-0 transform -translate-x-1/2 dashed"></div>
                                    {[
                                        { id: 1, name: 'Sound Forest', desc: 'Phonics Challenge', icon: <Icons.Mic /> },
                                        { id: 2, name: 'Word Valley', desc: 'Vocabulary Blast', icon: <Icons.Sun /> },
                                        { id: 3, name: 'Action River', desc: 'Logic & Phrases', icon: <Icons.Wind /> },
                                        { id: 4, name: 'Grammar Peak', desc: 'Boss Battle', icon: <Icons.Phone /> },
                                    ].map((level) => {
                                        const isUnlocked = unlockedLevels.includes(level.id);
                                        const isCompleted = unlockedLevels.includes(level.id + 1) || (level.id === 4 && unlockedLevels.includes('done'));
                                        const isCurrent = currentLevel === level.id && isUnlocked && !isCompleted;
                                        return (
                                            <button key={level.id} disabled={!isUnlocked} onClick={() => { setCurrentLevel(level.id); setView('game'); }} className={`relative z-10 w-full max-w-md p-4 rounded-2xl border-b-4 transition-all transform ${isUnlocked ? 'bg-white border-indigo-200 hover:scale-105 shadow-md cursor-pointer' : 'bg-gray-200 border-gray-300 opacity-70 cursor-not-allowed'} ${isCurrent ? 'ring-4 ring-yellow-400 scale-105' : ''}`}>
                                                <div className="flex items-center gap-4">
                                                    <div className={`p-3 rounded-full ${isUnlocked ? 'bg-indigo-100 text-indigo-600' : 'bg-gray-300 text-gray-500'}`}>{isCompleted ? <Icons.Check size={24} className="text-green-500" strokeWidth={4}/> : level.icon}</div>
                                                    <div className="text-left flex-1"><h3 className={`font-bold text-lg ${isUnlocked ? 'text-gray-800' : 'text-gray-500'}`}>{level.name}</h3><p className="text-xs text-gray-500">{level.desc}</p></div>
                                                    <div>{!isUnlocked && <Icons.Lock size={20} className="text-gray-400" />}{isUnlocked && !isCompleted && <Icons.Play size={20} className="text-indigo-400" fill="currentColor"/>}{isCompleted && <Icons.Star size={20} fill="gold" className="text-yellow-400"/>}</div>
                                                </div>
                                            </button>
                                        );
                                    })}
                                </div>
                            </div>
                        )}
                        {view === 'game' && <GameLevelWrapper currentLevel={currentLevel} lives={lives} coins={coins} setCoins={setCoins} setLives={setLives} setView={setView} handleLevelComplete={handleLevelComplete} />}
                        {view === 'victory' && (
                            <div className="flex flex-col items-center justify-center h-full animate-bounce-in text-center p-8 bg-yellow-50">
                                <Icons.Trophy size={80} className="text-yellow-500 drop-shadow-lg mb-6" />
                                <h2 className="text-3xl font-extrabold text-yellow-800 mb-2">Level Complete!</h2>
                                <p className="text-gray-600 mb-8">You are one step closer to saving the Weather Kingdom!</p>
                                <div className="bg-white p-6 rounded-2xl shadow-sm w-full mb-8">
                                    <div className="flex justify-between border-b pb-2 mb-2"><span className="text-gray-500">Coins Earned</span><span className="font-bold text-yellow-600">+{coins}</span></div>
                                    <div className="flex justify-between"><span className="text-gray-500">Lives Left</span><div className="flex text-red-500">{[...Array(lives)].map((_,i) => <Icons.Heart key={i} size={16} fill="currentColor"/>)}</div></div>
                                </div>
                                <button onClick={() => setView('map')} className="bg-green-500 text-white px-8 py-3 rounded-full font-bold shadow-lg hover:bg-green-600 flex items-center gap-2">Continue Adventure <Icons.ArrowRight /></button>
                            </div>
                        )}
                    </div>
                );
            };

            const root = ReactDOM.createRoot(document.getElementById('root'));
            root.render(<Unit5Adventure />);
        } catch (error) {
            document.getElementById('loading-container').style.display = 'none';
            document.getElementById('error-container').style.display = 'flex';
            document.getElementById('error-message').innerText = error.toString();
        }
    </script>
</body>
</html>
